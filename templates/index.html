<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ cliente.nome }} | Cashback</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0066cc">
  <style>
    .inativo {
      color: red;
      font-weight: bold;
      font-size: 0.95rem;
    }
    .ativo {
      color: green;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <h1>{{ cliente.nome }}</h1>
  </header>

  <main>
    {% with mensagens = get_flashed_messages(with_categories=true) %}
      {% if mensagens %}
        {% for categoria, msg in mensagens %}
          <div class="toast {{ categoria }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <p><strong>CPF:</strong> {{ cliente.cpf }}</p>
    <p><strong>Telefone:</strong> {{ cliente.telefone }}</p>
    <p><strong>Status:</strong> {% if cliente.inativo %}<span class="inativo">Inativo (6+ meses)</span>{% else %}<span class="ativo">Ativo</span>{% endif %}</p>
    <p><strong>Saldo de Cashback:</strong> R$ {{ "%.2f"|format(cliente.cashback) }}</p>

    <form action="/cashback/{{ cliente.cpf }}" method="POST" class="formulario">
      <label for="venda">Número da Venda:</label>
      <input type="text" name="venda" id="venda" required>

      <label for="venda_valor">Valor da Venda (R$):</label>
      <input type="number" name="venda_valor" id="venda_valor" min="0.01" step="0.01" required>

      <button type="submit">Adicionar Cashback</button>
    </form>

    <form action="/resgatar/{{ cliente.cpf }}" method="POST" class="formulario">
      <label for="resgate">Resgatar Cashback (R$):</label>
      <input type="number" name="resgate" id="resgate" min="0.01" step="0.01" required>

      <button type="submit">Resgatar</button>
    </form>

    <h2>Histórico</h2>
    {% if cliente.historico %}
      <ul>
        {% for item in cliente.historico|reverse %}
          <li>
            <strong>{{ item.tipo|capitalize }}</strong> —
            R$ {{ "%.2f"|format(item.valor) }} —
            {{ item.data }}
            {% if item.tipo == 'entrada' %}(Venda: {{ item.venda }}){% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Nenhuma movimentação registrada ainda.</p>
    {% endif %}

    <a href="/exportar/{{ cliente.cpf }}">⬇️ Exportar Histórico CSV</a>
    <br><br>
    <a href="/" class="btn-voltar">← Voltar</a>
  </main>

  <script>
    setTimeout(() => {
      const toast = document.querySelector(".toast");
      if (toast) toast.remove();
    }, 3000);
  </script>
</body>
</html>
